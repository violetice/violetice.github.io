(function(e,t){function r(e,t){return new Promise((function(r,n){e("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({target:t}))).then((e=>e.json())).then((({results:o,code:a,error:i})=>{if(a===401){throw i}if(o&&o.length>0){var l=o[0];r(l)}else{e("post","/classes/Counter",{target:t,time:0}).then((e=>e.json())).then(((e,t)=>{if(t){throw t}r(e)})).catch((e=>{console.error("Failed to create",e);n(e)}))}})).catch((e=>{console.error("LeanCloud Counter Error:",e);n(e)}))}))}function n(e,t){return new Promise((function(r,n){e("post","/batch",{requests:t}).then((e=>{e=e.json();if(e.error){throw e.error}r(e)})).catch((e=>{console.error("Failed to save visitor count",e);n(e)}))}))}function o(e){return{method:"PUT",path:`/1.1/classes/Counter/${e}`,body:{time:{__op:"Increment",amount:1}}}}function a(){var e="LeanCloud_UV_Flag";var t=localStorage.getItem(e);if(t){if((new Date).getTime()-parseInt(t,10)<=864e5){return false}}localStorage.setItem(e,(new Date).getTime().toString());return true}function i(i){var l=CONFIG.web_analytics.enable===true;var s=[];var c=[];var u=t.querySelector("#leancloud-site-pv-container");if(u){var p=r(i,"site-pv").then((e=>{l&&c.push(o(e.objectId));var r=t.querySelector("#leancloud-site-pv");if(r){r.innerText=e.time+1;if(u){u.style.display="inline"}}}));s.push(p)}var h=t.querySelector("#leancloud-site-uv-container");if(h){var d=r(i,"site-uv").then((e=>{var r=a();r&&l&&c.push(o(e.objectId));var n=t.querySelector("#leancloud-site-uv");if(n){n.innerText=e.time+(r?1:0);if(h){h.style.display="inline"}}}));s.push(d)}var v=t.querySelector("#leancloud-page-views-container");if(v){var f=decodeURI(e.location.pathname);var y=r(i,f).then((e=>{l&&c.push(o(e.objectId));if(v){var r=t.querySelector("#leancloud-page-views");if(r){r.innerText=(e.time||0)+1;v.style.display="inline"}}}));s.push(y)}if(l){Promise.all(s).then((()=>{c.length>0&&n(i,c)}))}}var l=CONFIG.web_analytics.leancloud.app_id;var s=CONFIG.web_analytics.leancloud.app_key;var c=CONFIG.web_analytics.leancloud.server_url;function u(e){var t=(t,r,n)=>fetch(`${e}/1.1${r}`,{method:t,headers:{"X-LC-Id":l,"X-LC-Key":s,"Content-Type":"application/json"},body:JSON.stringify(n)});i(t)}var p=l.slice(-9)!=="-MdYXbMMI"?c:`https://${l.slice(0,8).toLowerCase()}.api.lncldglobal.com`;if(p){u(p)}else{fetch("https://app-router.leancloud.cn/2/route?appId="+l).then((e=>e.json())).then((e=>{if(e.api_server){u("https://"+e.api_server)}}))}})(window,document);